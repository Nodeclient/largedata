class LargeData{constructor(a){this.speed=parseInt(a.speed)||1024,this.eid=a.form_id||"form",this.posturi=a.post_url||"/api/upload"}fields(call){if(null!=document.getElementById(this.eid)){let Fields=[];for(let name of document.getElementById(this.eid).getElementsByTagName("input")){let item=name.getAttribute("id")||name.getAttribute("name");if(item){var attribute=[];for(const attr of name.attributes)if(attr.value)try{var result=eval("({"+(attr.name+"").replace("data-","")+":\""+attr.value+"\"})");attribute.push(result)}catch(a){return call({code:"1500",msg:"TYPE_ERROR"},{error:"Invalid Syntax -> "+(attr.name+"")}),!1}0<attribute.length&&Fields.push({attribute,id:item,value:name.value}),attribute=[]}}_f(Fields,this.posturi).then(a=>{if(!a.ok)throw new Error("URL is not recognized ("+this.posturi+")");else call({code:"0005",msg:"SUCCESS"})}).catch(a=>{call({code:"1600",msg:"NETWORK_ERROR"},{error:a+""})})}else call({code:"1100",msg:"ID_ERROR"},{error:"Invalid form id ("+this.eid+")",status:0})}upload(a){if(null!=document.getElementById(this.eid)){var b=document.getElementById(this.eid).getElementsByTagName("input"),c=null;for(var d of b)"file"==d.getAttribute("type")?c=d.files:null;if(null!=c){function b(b,d,e){e?a({code:"1800",msg:"UPLOAD_ERROR"},{},{error:e.error,status:503}):"0002"==b.code?(a(b,d,e),f(c.length)):a(b,d,e)}var e={i:0,form_id:this.eid,speed:this.speed,post_url:this.posturi},f=d=>{if(e.i<=d-1)return e.i++,a({code:"0001",msg:"UPLOAD_STARTING"},{}),new LargeData(e).FileSystem(e.i-1,c,e,b);if(0<e.i||0<d){let b=[];for(var f of c)b.push({name:f.name,size:_bs(f.size).size,mime:f.type});a({code:"0003",msg:"FINISHED",list:b},{})}else a({code:"1300",msg:"FILE_ERROR"},{},{error:"File not selected",status:-1})};f(c.length)}else a({code:"1110",msg:"INPUT_ERROR"},{},{error:"Input element (type=file) not found.",status:0})}else a({code:"1100",msg:"ID_ERROR"},{},{error:"Invalid form id ("+this.eid+")",status:0})}FileSystem(b,c,a,d){var e=c[b],f={ups:a.speed,offset:0,bytes:0,uri:a.post_url};if(e){var g=new FileReader,h=e.size,i=e.name;g.onerror=function(){d({code:"1300",msg:"FILE_ERROR"},{},{error:"File read error.",status:0}),g.abort()},g.onloadend=function(a){if(a.target.readyState==FileReader.DONE){const c=new Int8Array(a.target.result);if(f.bytes+=c.length,0<c.length&&_s({name:i,size:h,chunk:Object.values(c||[])},f.uri).then(a=>{if(!a.ok)throw new Error("URL is not recognized ("+f.uri+")");else b()}).catch(a=>{d({code:"1600",msg:"NETWORK_ERROR"},{},{error:a+""})}),f.offset<=h){var b=()=>{f.offset+=f.ups;var a=e.slice(f.offset,f.offset+f.ups);g.readAsArrayBuffer(a)};d({code:"0004",msg:"UPLOADING",name:i,percent:(100*(f.bytes/h)).toFixed(0)},_ns(h,f.ups,10))}else d({code:"0002",msg:"UPLOAD_DONE",name:i,size:_bs(h)},{})}}}else d({code:"1120",msg:"INPUT_ERROR"},{},{error:"File not selected",status:-1});var j=e.slice(f.offset,f.offset+f.ups);g.readAsArrayBuffer(j)}}var _s=async function(a,b){return await fetch(b,{cache:"no-store",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:a})})},_f=async function(a,b){return await fetch(b,{cache:"no-store",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({field:a||[]})})},_ns=function(a,b,c){var d=parseFloat(8*(a/1024)/b/60),e=parseInt(d/100)*parseInt(c),f=parseInt(d)+parseInt(e),g=Math.floor(f/60),h=Math.round(60*(f/60-g)),i={speed:0,prefix:"Kbps",type:"Dialed-up"};return 1e6<=b?(i.speed=(b/1e6).toFixed(1),i.prefix="Gbps"):1e3<=b?(i.speed=(b/1e3).toFixed(1),i.prefix="Mbps"):1<=b&&(i.speed=b.toFixed(0),i.prefix="Kbps"),2e5<=b?i.type="5G":5e4<=b?i.type="Fiber":1e3<=b?i.type="ADSL,LAN,3G,4G":80<=b&&(i.type="Modem"),{network:i,time:{hour:g+"",minute:1>h?"1>":h}}},_bs=function(a){let b=a/Math.pow(1024,0),c=a/Math.pow(1024,1),d=a/Math.pow(1024,2),e=a/Math.pow(1024,3);if(1<e.toFixed(1))return{size:e.toFixed(1).concat("GB")};return 1<d.toFixed(1)?{size:d.toFixed(1).concat("MB")}:1<c.toFixed(1)?{size:c.toFixed(1).concat("KB")}:1<b.toFixed(1)?{size:b.toFixed(1).concat("B")}:void 0};